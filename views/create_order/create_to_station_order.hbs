



<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>




<link rel="stylesheet" href="/css/employee.css">






{{!-- <nav class="navbar navbar-dark navbar-expand-lg" style="background-color: #1e1e86;">

    <div class="container">
        <a class="navbar-brand magic-post-text" href="">Magic Post</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">

            </ul>
            <div class="nav-item dropdown" style="color:white;">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    {{employee.lastName}} {{employee.firstName}}
                </a>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="#">Hồ sơ</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="/create_to_wh_order">Tạo đơn hàng đến điểm tập kết</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="#">Đăng xuất</a></li>
                </ul>
                <div>
                </div>
            </div>

</nav> --}}



<div class="row justify-content-center align-items-center">
    <div class="col-lg-12 col-sm-9">
        <form id="order-to-station-form" action="/stored/to_station_order" method="post">
            <h4 class="form-title">Đơn chuyển hàng đến điểm giao dịch đích</h4>
            <div class="input-control">
                <label for="name" id="label-name">
                    Người tạo đơn
                </label>

                <input class="readonly" type="text" id="name" value="{{employee.lastName}} {{employee.firstName}}"
                    readonly />
            </div>

            <div class="input-control">
                <label for="employeeId" id="label-employeeId">
                    Mã nhân viên
                </label>

                <input class="readonly" type="text" id="employeeId" name="employeeId" value="{{employee.employeeId}}"
                    readonly />
            </div>

            <div class="input-control">
                <label for="workPlace" id="label-workPlace">
                    Nơi làm việc
                </label>

                <input class="readonly" type="text" id="workPlace" value="{{workPlace.id}} - {{workPlace.name}}"
                    readonly />

                <input type="hidden" name="senderAddressId" value="{{workPlace.id}}">
            </div>

        

    
            <input type="hidden" name="typeOfOrder" value="warehouse-station">

            <div class="input-control">
                <label for="desStation" id="label-desStation">
                    Điểm giao dịch đích
                </label>

                <select name="receiverAddressId" id="desStation" required autofocus>
                    <option value="none" selected disabled hidden>Chọn một điểm giao dịch</option>
                    {{#each desStations}}
                    <option value="{{this.id}}">{{this.id}} - {{this.name}}</option>
                    {{/each}}


                </select>
            </div>


            <div class="input-control">
                <label>Các mã hàng sẽ chuyển đến điểm giao dịch đích</label>
                {{#unless posts}}
                <textarea placeholder="Hiện không có mã hàng nào cần chuyển đến các điểm giao dịch đích!"
                    readonly></textarea>
                {{/unless}}

                {{#if posts}}
                <div id="no-posts"></div>

                {{#each posts}}
                <div class="post-checkbox-container" data-rstationid="{{this.receiverStationId}}"
                    data-postid="{{this.id}}" data-postname="{{this.name}}">

                </div>
                {{/each}}
                {{/if}}
            </div>
      




            <div class="input-control">
                <label for="total-posts" id="label-total-posts">
                    Tổng số hàng trong lô

                </label>

                <input class="readonly" type="text" id="total-posts" readonly />
            </div>




            <button id="submit-button" class="btn btn-success" type="button" data-bs-toggle="modal"
                data-bs-target="#confirm-submit" disabled>
                Tạo đơn
            </button>
        </form>
    </div>

</div>




<!-- Modal -->
<div class="modal fade" id="confirm-submit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Xác nhận tạo đơn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Bạn chắc chắn muốn tạo đơn chuyển lô hàng gồm <span id="numOfPosts">0</span> mã hàng đến điểm giao dịch
                đích chứ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bỏ lệnh</button>
                <button id="confirm-submit-button" type="button" class="btn btn-primary">Xác nhận</button>
            </div>
        </div>
    </div>
</div>



<script>
    const btnConfirmSubmit = document.getElementById('confirm-submit-button');
    btnConfirmSubmit.addEventListener('click', () => {
        document.getElementById('order-to-station-form').submit();
    });

    const numOfPosts = document.querySelector('#numOfPosts');

    const submitButton = document.querySelector('#submit-button');

    

    const desStationSelect = document.getElementById('desStation');
    const postCheckboxContainers = document.querySelectorAll('.post-checkbox-container');

    desStationSelect.addEventListener('change', (event) => {


        let selectedStationId = event.target.value;


        for (const checkboxContainer of postCheckboxContainers) {
            let receiverStationId = checkboxContainer.dataset.rstationid;


            if (receiverStationId === selectedStationId) {

                let postId = checkboxContainer.dataset.postid;
                let postName = checkboxContainer.dataset.postname;
                let htmlContent = `<label><input type="checkbox" name="postIds" value="${postId}"> ${postId} - ${postName}</input></label>`
                checkboxContainer.innerHTML = htmlContent;
            } else {
                checkboxContainer.innerHTML = '';
            }
        }

        const checkboxList = document.querySelectorAll('input[type="checkbox"]');
        const postsCount = document.querySelectorAll('input[type="checkbox"]').length;

        if (postsCount === 0) {
            document.querySelector('#no-posts').innerHTML = `<textarea placeholder="Hiện không có mã hàng nào cần chuyển đến điểm giao dịch đã chọn!" readonly></textarea>`;
        } else {
            document.querySelector('#no-posts').innerHTML = '';
        }

        let checkedCount = 0;

        if (checkedCount !== 0) {
            submitButton.disabled = false;
        } else {
            submitButton.disabled = true;
        }

        document.querySelector('#total-posts').value = checkedCount;
        numOfPosts.innerHTML = checkedCount;

        for (const checkbox of checkboxList) {
            checkbox.addEventListener('change', () => {
                checkedCount = document.querySelectorAll('input[type="checkbox"]:checked').length;
                document.querySelector('#total-posts').value = checkedCount;
                numOfPosts.innerHTML = checkedCount;

                if (checkedCount !== 0) {
                    submitButton.disabled = false;
                } else {
                    submitButton.disabled = true;
                }
            });
        }



    });


</script>