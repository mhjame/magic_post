<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Maps Example</title>
  <style>
    #map {
      height: 400px;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>Google Maps Directions</h1>
  
  <!-- Removed the label for the start input, as it's not needed -->
  <input type="text" id="start" style="display: none;"> <!-- Hidden input for the start location -->

  <label for="end">Điểm Đến:</label>
  <input type="text" id="end" placeholder="Nhập điểm đến">

  <button onclick="calculateRoute()">Tìm Đường Đi</button>
  <button onclick="getCurrentLocation()">Lấy Vị Trí Hiện Tại</button>

  <div id="map"></div>

  <script>
    let map;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 37.7749, lng: -122.4194 },
        zoom: 12,
      });
    }

    function getCurrentLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          const currentLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
          };

          map.setCenter(currentLocation);

          const marker = new google.maps.Marker({
            position: currentLocation,
            map: map,
            title: 'Vị Trí Hiện Tại',
          });

          // Set the value of the hidden start input to the current location
          document.getElementById('start').value = 'Vị Trí Hiện Tại';
        }, function() {
          alert('Không thể lấy vị trí hiện tại.');
        });
      } else {
        alert('Trình duyệt không hỗ trợ định vị.');
      }
    }

    function calculateRoute() {
      const startInput = document.getElementById('start');
      const endInput = document.getElementById('end');

      const start = startInput.value; // Start location is set to the current location

      const end = endInput.value;

      const directionsService = new google.maps.DirectionsService();
      const directionsDisplay = new google.maps.DirectionsRenderer();

      directionsDisplay.setMap(map);

      const request = {
        origin: start,
        destination: end,
        travelMode: 'DRIVING',
      };

      directionsService.route(request, function(result, status) {
        if (status == 'OK') {
          directionsDisplay.setDirections(result);
        } else {
          alert('Không tìm thấy đường đi. Hãy kiểm tra lại thông tin đầu vào.');
        }
      });
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDr5bFiilGk1VDzGxncM6SSwPAmxqN7AIc&callback=initMap">
  </script>
</body>
</html>
